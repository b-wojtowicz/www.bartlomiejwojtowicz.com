<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta itemprop=name content="Experimenting With Github Actions (beta)"><meta itemprop=description content="This article was originally published here.
With the upcoming new GitHub Actions feature, I was very excited to test it, so I immediately signed up for the beta access and finally my invitation had been accepted.
The reason for my excitement mainly comes from my current project where I am mostly responsible for managing the infrastructure in AWS (Terraform) and backend development (Ruby on Rails) — if I have time for it."><meta itemprop=datePublished content="2019-01-05T18:00:00+02:00"><meta itemprop=dateModified content="2019-01-05T18:00:00+02:00"><meta itemprop=wordCount content="1507"><meta itemprop=keywords content="docker,github,github actions,aws,pipeline,ci,"><meta property="og:title" content="Experimenting With Github Actions (beta)"><meta property="og:description" content="This article was originally published here.
With the upcoming new GitHub Actions feature, I was very excited to test it, so I immediately signed up for the beta access and finally my invitation had been accepted.
The reason for my excitement mainly comes from my current project where I am mostly responsible for managing the infrastructure in AWS (Terraform) and backend development (Ruby on Rails) — if I have time for it."><meta property="og:type" content="article"><meta property="og:url" content="https://qbart.dev/posts/2019/experimenting-with-github-actions-beta/"><meta property="article:published_time" content="2019-01-05T18:00:00+02:00"><meta property="article:modified_time" content="2019-01-05T18:00:00+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Experimenting With Github Actions (beta)"><meta name=twitter:description content="This article was originally published here.
With the upcoming new GitHub Actions feature, I was very excited to test it, so I immediately signed up for the beta access and finally my invitation had been accepted.
The reason for my excitement mainly comes from my current project where I am mostly responsible for managing the infrastructure in AWS (Terraform) and backend development (Ruby on Rails) — if I have time for it."><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Experimenting With Github Actions (beta)</title><link rel=stylesheet href=https://qbart.dev/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous><link rel=stylesheet href=https://qbart.dev/css/custom.css></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://qbart.dev/>tail -f qbart.dev.log</a></div><nav class="site-nav hide-in-mobile"><a href=https://qbart.dev/about/>About</a>
<a href=https://qbart.dev/posts/>Posts</a>
<a href=https://qbart.dev/projects/>Open source</a>
<a href=https://b.qbart.dev>Bookmarks</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=mailto:hiATqbart.dev target=_blank rel="noopener me" title=Email><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=https://github.com/qbart target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://www.linkedin.com/in/bartlomiej-wojtowicz-24b58b1b target=_blank rel="noopener me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://twitter.com/softkiwi target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://pinterest.com/bartlomiejwojtowicz/ target=_blank rel="noopener me" title=Pinterest><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://qbart.dev/about/>About</a></li><li><a href=https://qbart.dev/posts/>Posts</a></li><li><a href=https://qbart.dev/projects/>Open source</a></li><li><a href=https://b.qbart.dev>Bookmarks</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Jan 5, 2019</span></div><h1>Experimenting With Github Actions (beta)</h1></header><div class=content><p>This article was originally published <a href=https://medium.com/selleo/experimenting-with-github-actions-beta-760e61fab0e1>here</a>.</p><p>With the upcoming new GitHub Actions feature, I was very excited to test it, so I immediately signed up for the beta access and finally my invitation had been accepted.</p><p>The reason for my excitement mainly comes from my current project where I am mostly responsible for managing the infrastructure in AWS (Terraform) and backend development (Ruby on Rails) — if I have time for it. We also have a lot of PWA that we deploy to AWS Cloudfront so there is a constant need for automation (we still do some things manually but we are improving everyday). Our simplified pipeline looks like this:</p><ol><li>GitHub PR (master &lt;- feature branch)</li><li>CircleCI</li></ol><ul><li>linter</li><li>specs</li><li>aws push to CodePipeline or trigger Cloudfront invalidation for PWA (only from master)</li></ul><ol start=3><li>AWS CodePipeline starts image building and ECS deployment</li></ol><p>As much as I like some of the Amazon services, AWS CodePipeline is not one of them so with GitHub Actions on the rise I hope to replace it completely. To verify if that&rsquo;s even possible I created a dummy project that will test the following:</p><ul><li>linter (rubocop)</li><li>tests (rspec)</li><li>deployment from master only (Heroku will do for now, I can expand that later to AWS)</li><li>notification (when the process is done)</li></ul><p>In this article, I won&rsquo;t be going into details what GitHub Actions is and how everything works because GitHub documentation will do a much better job and I don&rsquo;t want to duplicate the content that is already there, especially, that it is a beta and things might change. I will only highlight a few things and most of the time I will leave you with the link to the GitHub pages.</p><p>For the Ruby app I used Sinatra and wrote one silly endpoint:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>get <span style=color:#f1fa8c>&#39;/&#39;</span> <span style=color:#ff79c6>do</span>
   <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>#{</span>ENV<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;RACK_ENV&#39;</span><span style=color:#ff79c6>]</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>: Hello there! My secret is </span><span style=color:#f1fa8c>#{</span>ENV<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;MY_SECRET&#39;</span><span style=color:#ff79c6>]</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>
<span style=color:#ff79c6>end</span>
</code></pre></div><p>and its corresponding spec:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>describe <span style=color:#f1fa8c>&#39;Test GitHub Action&#39;</span> <span style=color:#ff79c6>do</span>
  it <span style=color:#f1fa8c>&#39;returns appropriate text for index page&#39;</span> <span style=color:#ff79c6>do</span>
    get <span style=color:#f1fa8c>&#39;/&#39;</span>
    expect(last_response<span style=color:#ff79c6>.</span>body)<span style=color:#ff79c6>.</span>to eq <span style=color:#f1fa8c>&#39;test: Hello there! My secret is 123&#39;</span>
  <span style=color:#ff79c6>end</span>
<span style=color:#ff79c6>end</span>
</code></pre></div><p>For Docker, no surprises here, just a small file:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=color:#ff79c6>FROM</span><span style=color:#f1fa8c> ruby:2.5.1</span>
<span style=color:#ff79c6>ARG</span> RACK_ENV
<span style=color:#ff79c6>ARG</span> PORT
<span style=color:#ff79c6>ENV</span> APP_HOME /app
<span style=color:#ff79c6>RUN</span> apt-get update -qq <span style=color:#ff79c6>&amp;&amp;</span> apt-get install -y build-essential
<span style=color:#ff79c6>RUN</span> mkdir <span style=color:#8be9fd;font-style:italic>$APP_HOME</span>
<span style=color:#ff79c6>WORKDIR</span><span style=color:#f1fa8c> $APP_HOME</span>
<span style=color:#ff79c6>ADD</span> . <span style=color:#8be9fd;font-style:italic>$APP_HOME</span>/
<span style=color:#ff79c6>RUN</span> bundle install — without development test
<span style=color:#ff79c6>CMD</span> rackup -p <span style=color:#8be9fd;font-style:italic>$PORT</span> — host 0.0.0.0
</code></pre></div><p>GitHub Actions come with some predefined actions built by the GitHub team. One of them is Heroku and Docker cli tools, to name a few. For more, please take a look at the documentation <a href=https://github.com/actions>here</a>.</p><p>There is also a GUI for defining actions and works pretty well but I prefer doing this in my code editor.</p><p>First, create a workflow file <code>.github/main.workflow</code>:</p><pre><code class=language-github data-lang=github>workflow &quot;Test and deploy to Heroku&quot; {
 on = &quot;push&quot;
 resolves = [&quot;ruby.build&quot;]
}
</code></pre><p><a href=https://developer.github.com/actions/managing-workflows/workflow-configuration-options/>Workflow</a> definition is pretty self-explanatory so just a short comment:</p><ul><li><code>on</code> defines event when the whole process kicks in (push type is the only one available in beta)</li><li><code>resolves</code> specifies a list of target actions to resolve (you can put any text here but I kinda like namespace.action convention for my purposes - this comes in handy later when you declare your action dependencies)</li></ul><p>First action:</p><pre><code class=language-github data-lang=github>action &quot;ruby.build&quot; {
 uses = &quot;actions/docker/cli@master&quot;
 args = &quot;build -f Dockerfile.test -t ci-$GITHUB_SHA:latest .&quot;
}
</code></pre><p>This will build a docker container that will be used for linting and testing.</p><p>Please also note that there some built-in <code>GITHUB_*</code> envs for you to use, list <a href=https://developer.github.com/actions/creating-github-actions/accessing-the-runtime-environment/#environment-variables>here</a>.</p><p>Action breakdown:</p><ul><li><code>uses</code> declares what kind of action will it be and could be read as follows: <code>:github_user_or_org_name/:repository/:folder@:ref</code> — as a ref I used master but for production workflows, you probably want to stick with a specific release tag or commit SHA and upgrade periodically</li><li><code>args</code> are just arguments passed to underlying command (in this action it will be <code>docker ...</code>)</li></ul><p>Take a look here how the action repository looks like <a href=https://github.com/actions/docker/tree/master/cli>here</a>.</p><p>Next part of the workflow can be run in parallel so:</p><pre><code class=language-github data-lang=github>action &quot;ruby.rubocop&quot; {
 uses = &quot;actions/docker/cli@master&quot;
 needs = [&quot;ruby.build&quot;]
 args = &quot;run ci-$GITHUB_SHA:latest rubocop&quot;
}

action &quot;ruby.rspec&quot; {
 uses = &quot;actions/docker/cli@master&quot;
 needs = [&quot;ruby.build&quot;]
 args = &quot;run ci-$GITHUB_SHA:latest rspec&quot;
}
</code></pre><p>Nothing new here except <code>needs</code> that specifies dependencies for actions (and that&rsquo;s why I am using <code>namespace.action</code> style rather than using <code>Build Ruby image</code> etc., it&rsquo;s just easier for me to track it with eyes).</p><p>I used a separate <code>Dockerfile</code> for a test environment so I can declare required variables there:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=color:#ff79c6>FROM</span><span style=color:#f1fa8c> ruby:2.5.1</span>

<span style=color:#ff79c6>ENV</span> RACK_ENV test
<span style=color:#ff79c6>ENV</span> MY_SECRET <span style=color:#bd93f9>123</span> <span style=color:#6272a4># if you want this to be out of the repo just use `ARG MY_SECRET` and define secrets in github action</span>
<span style=color:#ff79c6>ENV</span> APP_HOME /app

<span style=color:#ff79c6>RUN</span> apt-get update -qq <span style=color:#ff79c6>&amp;&amp;</span> apt-get install -y build-essential
<span style=color:#ff79c6>RUN</span> mkdir <span style=color:#8be9fd;font-style:italic>$APP_HOME</span>

<span style=color:#ff79c6>WORKDIR</span><span style=color:#f1fa8c> $APP_HOME</span>
<span style=color:#ff79c6>ADD</span> . <span style=color:#8be9fd;font-style:italic>$APP_HOME</span>/

<span style=color:#ff79c6>RUN</span> bundle install
</code></pre></div><p>Ok, so tests are running, now we want to start a deployment but only if the branch is <code>master</code>. There is another pre-built <a href=https://github.com/actions/bin>action</a> for that:</p><pre><code class=language-github data-lang=github>action &quot;git.master&quot; {
  uses = &quot;actions/bin/filter@master&quot;
  needs = [&quot;ruby.rubocop&quot;, &quot;ruby.rspec&quot;]
  args = &quot;branch master&quot;
}
</code></pre><p>Before we start with Heroku workflow we need to create a project first. We will also need:</p><ul><li>to generate Heroku api key (<code>heroku authorizations:create</code>)</li><li>to set the stack to the container based (<code>heroku stack:set container</code>)</li><li>a project name (I named mine <code>test-github-actions</code>)</li></ul><p>Heroku action is described <a href=https://github.com/actions/heroku>here</a>. As of now, there is only one required secret <code>HEROKU_API_KEY</code> that has to contain your authorization key. You want to add this key to GitHub <a href=https://developer.github.com/actions/managing-workflows/storing-secrets/>secrets</a>.</p><pre><code class=language-github data-lang=github>action &quot;heroku.login&quot; {
  uses = &quot;actions/heroku@master&quot;
  needs = [&quot;git.master&quot;]
  args = &quot;container:login&quot;  secrets = [&quot;HEROKU_API_KEY&quot;]
}
</code></pre><p><code>secrets</code> tells to decrypt declared variables in this action and expose them internally as an ENV (otherwise they won&rsquo;t be available), also <strong>do not</strong> print them because they might remain in logs.</p><p>Once we are logged in we can push our image:</p><pre><code class=language-github data-lang=github>action &quot;heroku.push&quot; {
  uses = &quot;actions/heroku@master&quot;
  needs = &quot;heroku.login&quot;
  args = &quot;container:push web&quot;

  secrets = [
    &quot;HEROKU_API_KEY&quot;,
    &quot;HEROKU_APP&quot;
  ]

  env = {
    RACK_ENV = &quot;production&quot;
  }
}
</code></pre><p>A little more explanation here, first I used <code>HEROKU_APP</code> which means that container will push image to whatever app that is defined there. There are actually multiple ways of how this could be achieved:</p><pre><code class=language-github data-lang=github>args = &quot;container:push -a test-github-actions web&quot;
</code></pre><p>or</p><pre><code class=language-github data-lang=github>args = &quot;container:push web&quot;

env = {
  HEROKU_APP = &quot;test-github-actions&quot;
}
</code></pre><p>Personally, I preferred to put in secrets here so it requires less typing later if you need to use it multiple times in different actions.</p><p><code>RACK_ENV = "production"</code> is defined here as a building environment variable for docker image (our dockerfile had: <code>ARG RACK_ENV</code>).</p><p>For the following piece, I used <code>heroku config:set</code> command to propagate all my variables and secrets to heroku runtime variables:</p><pre><code class=language-github data-lang=github>action &quot;heroku.envs&quot; {
  uses = &quot;actions/heroku@master&quot;
  needs = &quot;heroku.push&quot;

  args = [
    &quot;config:set&quot;,
    &quot;RACK_ENV=$RACK_ENV&quot;,
    &quot;MY_SECRET=$MY_SECRET&quot;
  ]

  secrets = [
    &quot;HEROKU_API_KEY&quot;,
    &quot;HEROKU_APP&quot;,
    &quot;MY_SECRET&quot;
  ]

  env = {
    RACK_ENV = &quot;production&quot;
  }
}
</code></pre><p>And finally, a deployment:</p><pre><code class=language-github data-lang=github>action &quot;heroku.deploy&quot; {
  uses = &quot;actions/heroku@master&quot;
  needs = [&quot;heroku.envs&quot;, &quot;heroku.push&quot;]

  args = [&quot;container:release&quot;, &quot;web&quot;]

  secrets = [
    &quot;HEROKU_API_KEY&quot;,
    &quot;HEROKU_APP&quot;,
    &quot;MY_SECRET&quot;
  ]

  env = {
    RACK_ENV = &quot;production&quot;
  }
}
</code></pre><p>At this moment, you should also update your workflow:</p><pre><code class=language-github data-lang=github>...
resolves = [&quot;heroku.deploy&quot;]
...
</code></pre><p>because that&rsquo;s the action you need to resolve to.</p><p>For a cherry on the top, I would add Slack notification and for that, we will need custom action, turns out it&rsquo;s easy to do this. As a starting point, replicate the following structure in your project folder:</p><pre><code class=language-term data-lang=term>.github/
  slack/
    Dockerfile
    entrypoint.sh
</code></pre><p>For <code>entrypoint.sh</code> I defined a simple message posting to Slack:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#ff79c6>#!/bin/sh
</span><span style=color:#ff79c6></span><span style=color:#8be9fd;font-style:italic>set</span> -e
curl -X POST -H <span style=color:#f1fa8c>&#39;Content-type: application/json&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span> --data <span style=color:#f1fa8c>&#34;{\&#34;text\&#34;: \&#34;</span><span style=color:#8be9fd;font-style:italic>$*</span><span style=color:#f1fa8c>\&#34;,\&#34;attachments\&#34;:[{\&#34;footer\&#34;: \&#34;</span><span style=color:#8be9fd;font-style:italic>$GITHUB_ACTOR</span><span style=color:#f1fa8c> / </span><span style=color:#8be9fd;font-style:italic>$GITHUB_REPOSITORY</span><span style=color:#f1fa8c> / </span><span style=color:#8be9fd;font-style:italic>$GITHUB_SHA</span><span style=color:#f1fa8c>\&#34;}]}&#34;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span><span style=color:#8be9fd;font-style:italic>$SLACK_WEBHOOK_URL</span>
</code></pre></div><p>The important part: <code>$*</code> - command arguments will be pasted here. For the rest, please refer to Slack documentation.</p><p>Minimal dockerfile:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=color:#ff79c6>FROM</span><span style=color:#f1fa8c> debian:9.5-slim</span>

<span style=color:#ff79c6>RUN</span> apt-get update -qq <span style=color:#ff79c6>&amp;&amp;</span> apt-get install -y curl

<span style=color:#ff79c6>ARG</span> SLACK_WEBHOOK_URL
<span style=color:#ff79c6>ARG</span> GITHUB_ACTOR
<span style=color:#ff79c6>ARG</span> GITHUB_REPOSITORY
<span style=color:#ff79c6>ARG</span> GITHUB_SHA

<span style=color:#ff79c6>LABEL</span> <span style=color:#f1fa8c>&#34;com.github.actions.name&#34;</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Slack notifier&#34;</span>
<span style=color:#ff79c6>LABEL</span> <span style=color:#f1fa8c>&#34;com.github.actions.description&#34;</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Sends message to slack channel&#34;</span>
<span style=color:#ff79c6>LABEL</span> <span style=color:#f1fa8c>&#34;com.github.actions.icon&#34;</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;bell&#34;</span>
<span style=color:#ff79c6>LABEL</span> <span style=color:#f1fa8c>&#34;com.github.actions.color&#34;</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;yellow&#34;</span>

<span style=color:#ff79c6>ADD</span> entrypoint.sh /entrypoint.sh
<span style=color:#ff79c6>ENTRYPOINT</span> [<span style=color:#f1fa8c>&#34;/entrypoint.sh&#34;</span>]
</code></pre></div><p>GitHub labels allow to customize the visual appearance of our action (you can see it later in GitHub workflow view). For a full customization refer to the documentation: <a href=https://developer.github.com/actions/creating-github-actions/creating-a-new-action/#hello-world-action-example>creating-a-new-action</a> / <a href=https://developer.github.com/actions/creating-github-actions/creating-a-docker-container/#label>color list</a> / <a href=https://developer.github.com/actions/creating-github-actions/creating-a-docker-container/#supported-feather-icons>icon list</a>.</p><p>At the end, make sure your code is executable:</p><pre><code class=language-term data-lang=term>chmod +x entrypoint.sh
</code></pre><p>A final touch on workflow:</p><pre><code class=language-github data-lang=github>workflow &quot;Test and deploy to heroku&quot; {
  on = &quot;push&quot;
  resolves = [&quot;slack.notifier&quot;]
}

...

action &quot;slack.notifier&quot; {
  uses = &quot;./.github/slack&quot;
  needs = [&quot;heroku.deploy&quot;]
  args = &quot;Deployed!&quot;
  secrets = [&quot;SLACK_WEBHOOK_URL&quot;]
  # GITHUB_* envs are automatically here
}
</code></pre><p>and here is the result:</p><figure class=image><img src=/posts/2019/github-actions-beta-full-workflow.png><figcaption>Full workflow visualised</figcaption></figure><p>To sum it all up, I am very happy with the upcoming GitHub changes. My dummy project proved me that GitHub Actions are more than capable of replacing parts of our current pipeline and once a stable release is ready, we will plan to integrate it with our commercial project.</p><p>Link to repo: <a href=https://github.com/qbart/test-github-actions>https://github.com/qbart/test-github-actions</a>.</p><p>PS. If you find any errors in my article/code please let me know :)</p><p>And a couple of screenshots I took during the development:</p><figure class=image><img src=/posts/2019/github-actions-beta-managing-secrets.png><figcaption>Managing secrets</figcaption></figure><figure class=image><img src=/posts/2019/github-actions-beta-workflow-preview.png><figcaption>Workflow preview</figcaption></figure><figure class=image><img src=/posts/2019/github-actions-beta-editing-workflow-init.png><figcaption>Editing workflow (my initial attempts)</figcaption></figure><figure class=image><img src=/posts/2019/github-actions-beta-failed-workflow.png><figcaption>Failed workflow</figcaption></figure><figure class=image><img src=/posts/2019/github-actions-beta-failed-action-logs.png><figcaption>Failed action logs</figcaption></figure><figure class=image><img src=/posts/2019/github-actions-beta-invalid-workflow-config.png><figcaption>Invalid workflow config</figcaption></figure><figure class=image><img src=/posts/2019/github-actions-beta-workflow-in-progress.png><figcaption>Workflow in progress</figcaption></figure></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://qbart.dev/tags/docker>docker</a></span><span class=tag><a href=https://qbart.dev/tags/github>github</a></span><span class=tag><a href=https://qbart.dev/tags/github-actions>github actions</a></span><span class=tag><a href=https://qbart.dev/tags/aws>aws</a></span><span class=tag><a href=https://qbart.dev/tags/pipeline>pipeline</a></span><span class=tag><a href=https://qbart.dev/tags/ci>ci</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1507 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2019-01-05 16:00 +0000</p></footer></article><div class="post-nav thin"><a class=next-post href=https://qbart.dev/posts/2019/schema-based-multi-tenancy-in-postgresql/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>Schema based multi-tenancy in PostgreSQL</span></a>
<a class=prev-post href=https://qbart.dev/posts/2018/slides-from-ruby-to-crystal/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Slides: From Ruby to Crystal</span></a></div><div id=comments class=thin><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"qbart"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2021 <a href=https://qbart.dev/>Bartłomiej Wójtowicz</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://qbart.dev/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://qbart.dev/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-143750284-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>